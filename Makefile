v0.1.0: lsm-version=v0.1.0
v0.1.0: lib-version=v0.1.0 #user space version number need not to be identical to LSM
v0.1.0: ifc-version=v0.1.0 #user space version number need not to be identical to LSM

v0.1.1: lsm-version=v0.1.1
v0.1.1: lib-version=v0.1.1 #user space version number need not to be identical to LSM
v0.1.1: ifc-version=v0.1.1 #user space version number need not to be identical to LSM

v0.1.2: lsm-version=v0.1.2
v0.1.2: lib-version=v0.1.2 #user space version number need not to be identical to LSM
v0.1.2: ifc-version=v0.1.2 #user space version number need not to be identical to LSM
v0.1.2: config-version=v0.1.0 #user space version number need not to be identical to LSM

v0.1.3: lsm-version=v0.1.3
v0.1.3: lib-version=v0.1.3 #user space version number need not to be identical to LSM
v0.1.3: ifc-version=v0.1.2 #user space version number need not to be identical to LSM
v0.1.3: config-version=v0.1.0 #user space version number need not to be identical to LSM

v0.1.4: lsm-version=v0.1.4
v0.1.4: lib-version=v0.1.5 #user space version number need not to be identical to LSM
v0.1.4: ifc-version=v0.1.3 #user space version number need not to be identical to LSM
v0.1.4: config-version=v0.1.0 #user space version number need not to be identical to LSM

v0.1.5: lsm-version=v0.1.5
v0.1.5: lib-version=v0.1.6 #user space version number need not to be identical to LSM
v0.1.5: ifc-version=v0.1.3 #user space version number need not to be identical to LSM
v0.1.5: config-version=v0.1.1 #user space version number need not to be identical to LSM

v0.1.6: lsm-version=v0.1.6
v0.1.6: lib-version=v0.1.7 #user space version number need not to be identical to LSM
v0.1.6: ifc-version=v0.1.4 #user space version number need not to be identical to LSM
v0.1.6: config-version=v0.1.2 #user space version number need not to be identical to LSM

v0.1.7: lsm-version=v0.1.7
v0.1.7: lib-version=v0.1.8 #user space version number need not to be identical to LSM
v0.1.7: ifc-version=v0.1.4 #user space version number need not to be identical to LSM
v0.1.7: config-version=v0.1.3 #user space version number need not to be identical to LSM

v0.1.8: lsm-version=v0.1.8
v0.1.8: lib-version=v0.1.9 #user space version number need not to be identical to LSM
v0.1.8: ifc-version=v0.1.4 #user space version number need not to be identical to LSM
v0.1.8: config-version=v0.1.4 #user space version number need not to be identical to LSM

v0.1.9: lsm-version=v0.1.9
v0.1.9: lib-version=v0.1.10 #user space version number need not to be identical to LSM
v0.1.9: ifc-version=v0.1.4 #user space version number need not to be identical to LSM
v0.1.9: config-version=v0.1.5 #user space version number need not to be identical to LSM

v0.1.10: lsm-version=v0.1.10
v0.1.10: lib-version=v0.1.12 #user space version number need not to be identical to LSM
v0.1.10: ifc-version=v0.1.4 #user space version number need not to be identical to LSM
v0.1.10: config-version=v0.1.6 #user space version number need not to be identical to LSM

v0.1.11: lsm-version=v0.1.11
v0.1.11: lib-version=v0.1.13 #user space version number need not to be identical to LSM
v0.1.11: ifc-version=v0.1.4 #user space version number need not to be identical to LSM
v0.1.11: config-version=v0.1.7 #user space version number need not to be identical to LSM

v0.2.0: lsm-version=v0.2.0
v0.2.0: lib-version=v0.2.0 #user space version number need not to be identical to LSM
v0.2.0: config-version=v0.2.0 #user space version number need not to be identical to LSM

v0.2.1: lsm-version=v0.2.1
v0.2.1: lib-version=v0.2.0 #user space version number need not to be identical to LSM
v0.2.1: config-version=v0.2.0 #user space version number need not to be identical to LSM

v0.2.2: lsm-version=v0.2.2
v0.2.2: lib-version=v0.2.1 #user space version number need not to be identical to LSM
v0.2.2: config-version=v0.2.0 #user space version number need not to be identical to LSM

v0.2.3: lsm-version=v0.2.3
v0.2.3: lib-version=v0.2.3 #user space version number need not to be identical to LSM
v0.2.3: config-version=v0.2.1 #user space version number need not to be identical to LSM
v0.2.3: cli-version=v0.1.0 #user space version number need not to be identical to LSM

v0.3.0: lsm-version=v0.3.0
v0.3.0: lib-version=v0.3.0 #user space version number need not to be identical to LSM
v0.3.0: config-version=v0.3.0 #user space version number need not to be identical to LSM
v0.3.0: cli-version=v0.1.1 #user space version number need not to be identical to LSM

v0.3.1: lsm-version=v0.3.1
v0.3.1: lib-version=v0.3.1 #user space version number need not to be identical to LSM
v0.3.1: config-version=v0.3.0 #user space version number need not to be identical to LSM
v0.3.1: cli-version=v0.1.2 #user space version number need not to be identical to LSM
v0.3.1: service-version=v0.1.0

v0.3.2: lsm-version=v0.3.2
v0.3.2: lib-version=v0.3.1 #user space version number need not to be identical to LSM
v0.3.2: config-version=v0.3.0 #user space version number need not to be identical to LSM
v0.3.2: cli-version=v0.1.2 #user space version number need not to be identical to LSM
v0.3.2: service-version=v0.1.0

v0.3.3: lsm-version=v0.3.3
v0.3.3: lib-version=v0.3.2 #user space version number need not to be identical to LSM
v0.3.3: config-version=v0.3.1 #user space version number need not to be identical to LSM
v0.3.3: cli-version=v0.1.3 #user space version number need not to be identical to LSM
v0.3.3: service-version=v0.1.1

v0.3.4: lsm-version=v0.3.4
v0.3.4: lib-version=v0.3.5 #user space version number need not to be identical to LSM
v0.3.4: config-version=v0.3.2 #user space version number need not to be identical to LSM
v0.3.4: cli-version=v0.1.4 #user space version number need not to be identical to LSM
v0.3.4: service-version=v0.1.4

v0.3.5: lsm-version=v0.3.5
v0.3.5: lib-version=v0.3.7 #user space version number need not to be identical to LSM
v0.3.5: config-version=v0.3.3 #user space version number need not to be identical to LSM
v0.3.5: cli-version=v0.1.5 #user space version number need not to be identical to LSM
v0.3.5: service-version=v0.1.6

v0.3.6: lsm-version=v0.3.6
v0.3.6: lib-version=v0.3.8 #user space version number need not to be identical to LSM
v0.3.6: config-version=v0.3.4 #user space version number need not to be identical to LSM
v0.3.6: cli-version=v0.1.6 #user space version number need not to be identical to LSM
v0.3.6: service-version=v0.1.7

v0.3.7: lsm-version=v0.3.7
v0.3.7: lib-version=v0.3.8 #user space version number need not to be identical to LSM
v0.3.7: config-version=v0.3.4 #user space version number need not to be identical to LSM
v0.3.7: cli-version=v0.1.6 #user space version number need not to be identical to LSM
v0.3.7: service-version=v0.1.7

travis: lsm-version=v0.3.7
travis: lib-version=v0.3.8 #user space version number need not to be identical to LSM
travis: config-version=v0.3.4 #user space version number need not to be identical to LSM
travis: cli-version=v0.1.6 #user space version number need not to be identical to LSM
travis: service-version=v0.1.7

all: v0.3.7
package=0.4.0

prepare_provenance:
	mkdir -p build
	@echo "Downloading provenance library ${lib-version} ..."
	cd ./build && git clone https://github.com/camflow/libprovenance.git
	cd ./build/libprovenance && git checkout tags/${lib-version}
	cd ./build/libprovenance && $(MAKE) prepare

     prepare_ifc:
	mkdir -p build
	@echo "Downloading ifc library ${ifc-version} ..."
	cd ./build && git clone https://github.com/camflow/camflow-ifc-lib.git
	cd ./build/camflow-ifc-lib && git checkout tags/${ifc-version}
	cd ./build/camflow-ifc-lib && $(MAKE) prepare

prepare_config:
	mkdir -p build
	@echo "Downloading configuration service ${config-version} ..."
	cd ./build && git clone https://github.com/camflow/camconfd.git
	cd ./build/camconfd && git checkout tags/${config-version}
	cd ./build/camconfd && $(MAKE) prepare

prepare_cli:
	mkdir -p build
	@echo "Downloading command line interface ${cli-version} ..."
	cd ./build && git clone https://github.com/camflow/camflow-cli.git
	cd ./build/camflow-cli && git checkout tags/${cli-version}
	cd ./build/camflow-cli && $(MAKE) prepare

prepare_service:
	mkdir -p build
	@echo "Downloading service ${service-version} ..."
	cd ./build && git clone https://github.com/camflow/camflowd.git
	cd ./build/camflowd && git checkout tags/${service-version}
	cd ./build/camflowd && $(MAKE) prepare

prepare_lsm:
	mkdir -p build
	@echo "Downloading LSM patches..."
	cd ./build && git clone https://github.com/Wajihulhassan/camflow-patches.git
	cd ./build/camflow-patches/${lsm-version} && $(MAKE) prepare

config:
	@echo "Starting kernel configuration ..."
	cd ./build/camflow-patches/${lsm-version} && $(MAKE) config

config_travis:
	@echo "Starting kernel configuration ..."
	cd ./build/camflow-patches/${lsm-version} && $(MAKE) config_travis

compile_lsm:
	@echo "Building kernel ..."
	cd ./build/camflow-patches/${lsm-version} && $(MAKE) compile

compile_ifc:
	@echo "Building IFC library ..."
	cd ./build/camflow-ifc-lib && $(MAKE) all

compile_provenance:
	@echo "Building provenance library ..."
	cd ./build/libprovenance && $(MAKE) all

install_lsm:
	@echo "Installing kernel ..."
	cd ./build/camflow-patches/${lsm-version} && $(MAKE) install

install_ifc:
	@echo "Installing IFC library ..."
	cd ./build/camflow-ifc-lib && $(MAKE) install

install_provenance:
	@echo "Installing provenance library ..."
	cd ./build/libprovenance && $(MAKE) install

install_config:
	@echo "Building configuration service ..."
	cd ./build/camconfd && $(MAKE) all
	@echo "Installing configuration service ..."
	cd ./build/camconfd && $(MAKE) install

install_cli:
	@echo "Building command line interface ..."
	cd ./build/camflow-cli && $(MAKE) all
	@echo "Installing command line interface ..."
	cd ./build/camflow-cli && $(MAKE) install

install_service:
	@echo "Building command line interface ..."
	cd ./build/camflowd && $(MAKE) all
	@echo "Installing command line interface ..."
	cd ./build/camflowd && $(MAKE) install

clean:
	sudo rm -rf ./build

rpm:
	mkdir -p ~/rpmbuild/{RPMS,SRPMS,BUILD,SOURCES,SPECS,tmp}
	rpmbuild -bb camflow.spec
	mkdir -p output
	cp ~/rpmbuild/RPMS/x86_64/* ./output

rpm_us:
	cd ./build/camconfd && $(MAKE) rpm
	cd ./build/camflowd && $(MAKE) rpm
	cd ./build/camflow-cli && $(MAKE) rpm
	cd ./build/libprovenance && $(MAKE) rpm

all_rpm: rpm_us rpm

publish:
	cd ./output && package_cloud push camflow/provenance/fedora/26 camflow-$(package)-1.x86_64.rpm

publish_us:
	cd ./build/camconfd && $(MAKE) publish
	cd ./build/camflowd && $(MAKE) publish
	cd ./build/camflow-cli && $(MAKE) publish
	cd ./build/libprovenance && $(MAKE) publish

publish_all: publish_us publish

v0.1.0: prepare_ifc prepare_provenance prepare_lsm config compile_lsm compile_ifc compile_provenance install_lsm install_provenance install_ifc

v0.1.1: prepare_ifc prepare_provenance prepare_lsm config compile_lsm compile_ifc compile_provenance install_lsm install_provenance install_ifc

v0.1.2: prepare_ifc prepare_provenance prepare_config prepare_lsm config compile_lsm compile_ifc compile_provenance install_lsm install_provenance install_config install_ifc

v0.1.3: prepare_ifc prepare_provenance prepare_config prepare_lsm config compile_lsm compile_ifc compile_provenance install_lsm install_provenance install_config install_ifc

v0.1.4: prepare_ifc prepare_provenance prepare_config prepare_lsm config compile_lsm compile_ifc compile_provenance install_lsm install_provenance install_config install_ifc

v0.1.5: prepare_ifc prepare_provenance prepare_config prepare_lsm config compile_lsm compile_ifc compile_provenance install_lsm install_provenance install_config install_ifc

v0.1.6: prepare_ifc prepare_provenance prepare_config prepare_lsm config compile_lsm compile_ifc compile_provenance install_lsm install_provenance install_config install_ifc

v0.1.7: prepare_ifc prepare_provenance prepare_config prepare_lsm config compile_lsm compile_ifc compile_provenance install_lsm install_provenance install_config install_ifc

v0.1.8: prepare_ifc prepare_provenance prepare_config prepare_lsm config compile_lsm compile_ifc compile_provenance install_lsm install_provenance install_config install_ifc

v0.1.9: prepare_ifc prepare_provenance prepare_config prepare_lsm config compile_lsm compile_ifc compile_provenance install_lsm install_provenance install_config install_ifc

v0.1.10: prepare_ifc prepare_provenance prepare_config prepare_lsm config compile_lsm compile_ifc compile_provenance install_lsm install_provenance install_config install_ifc

v0.1.11: prepare_ifc prepare_provenance prepare_config prepare_lsm config compile_lsm compile_ifc compile_provenance install_lsm install_provenance install_config install_ifc

v0.2.0: prepare_provenance prepare_config prepare_lsm config compile_lsm compile_provenance install_lsm install_provenance install_config

v0.2.1: prepare_provenance prepare_config prepare_lsm config compile_lsm compile_provenance install_lsm install_provenance install_config

v0.2.2: prepare_provenance prepare_config prepare_lsm config compile_lsm compile_provenance install_lsm install_provenance install_config

v0.2.3: prepare_provenance prepare_config prepare_cli prepare_lsm config compile_lsm compile_provenance install_lsm install_provenance install_config install_cli

v0.3.0: prepare_provenance prepare_config prepare_cli prepare_lsm config compile_lsm compile_provenance install_lsm install_provenance install_config install_cli

v0.3.1: prepare_provenance prepare_config prepare_cli prepare_service prepare_lsm config compile_lsm compile_provenance install_lsm install_provenance install_config install_cli install_service

v0.3.2: prepare_provenance prepare_config prepare_cli prepare_service prepare_lsm config compile_lsm compile_provenance install_lsm install_provenance install_config install_cli install_service

v0.3.3: prepare_provenance prepare_config prepare_cli prepare_service prepare_lsm config compile_lsm compile_provenance install_lsm install_provenance install_config install_cli install_service

v0.3.4: prepare_provenance prepare_config prepare_cli prepare_service prepare_lsm config compile_lsm compile_provenance install_lsm install_provenance install_config install_cli install_service

v0.3.5: prepare_provenance prepare_config prepare_cli prepare_service prepare_lsm config compile_lsm compile_provenance install_lsm install_provenance install_config install_cli install_service

v0.3.6: prepare_provenance prepare_config prepare_cli prepare_service prepare_lsm config compile_lsm compile_provenance install_lsm install_provenance install_config install_cli install_service

v0.3.7: prepare_provenance prepare_config prepare_cli prepare_service prepare_lsm config compile_lsm compile_provenance install_lsm install_provenance install_config install_cli install_service

travis: prepare_provenance prepare_config prepare_cli prepare_service prepare_lsm config_travis compile_lsm compile_provenance install_lsm install_provenance install_cli
